<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title></title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
    <script src="/js/sweetfeedback-func.js"></script>
    <link href="css/style.css" media="screen" rel="stylesheet" type="text/css"/>
    <link href="css/uniform.css" media="screen" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery.tools.js"></script>
    <script type="text/javascript" src="js/jquery.uniform.min.js"></script>
    <script type="text/javascript" src="js/main.js"></script>

<script>
var socket = io.connect('http://209.129.244.24:9993/');

socket.on('connect', function(){
    $('#status').html("You are online.");
});


// naming rule
// <div id="div_nickname">
//   <canvas id="canvas_nickname"></canvas>
//   <div id="machine_nickname"></div>
//</div>

socket.on('update', function(nickname, data) {
    
    // if it is new gumball, create element
    if (!$("#div_" + nickname).length) 
	createElements(nickname); 

    updateGraph("canvas_" + nickname, data);
    //	updateGumball(div_name, data[0]);

});


function createElements(nickname) {

    // create div
    $('<div>').attr({id: "div_" + nickname, class: "div_nickname"}).insertAfter('.div_nickname:last');
    $("#div_" + nickname).append('<div class="TTWForm">');

    // create label
    $("#div_" + nickname + " .TTWForm").append('<div class="column">');
    $("#div_" + nickname + " .TTWForm" + " .column:last").html('<label>' + nickname + '</label>');

    // create canvas
    $("#div_" + nickname + " .TTWForm").append('<div class="column">');
    $("#div_" + nickname + " .TTWForm" + " .column:last").append('<canvas width="400px" height="300px" id="canvas_' + nickname + '"></canvas>');
    
    // create feedback buttons
    $("#div_" + nickname + " .TTWForm").append('<div class="column">');
    $("#div_" + nickname + " .TTWForm" + " .column:last").append('<div class="field f_25 clearfix submit"><input type="button" onClick="feedback(\'' + nickname + '\', \'A\')" value="A"></div>');
    $("#div_" + nickname + " .TTWForm" + " .column:last").append('<div class="field f_25 clearfix submit"><input type="button" onClick="feedback(\'' + nickname + '\', \'C\')" value="C"></div>');
    $("#div_" + nickname + " .TTWForm" + " .column:last").append('<div class="field f_25 clearfix submit"><input type="button" onClick="feedback(\'' + nickname + '\', \'D\')" value="D"></div>');
}

function feedback(nickname, type) {
    $.ajax({
        type: "POST",
        url: "/feedback",
        data: "nickname=" + nickname + "&type=" + type, 
        success: function(data)
        {
            alert("Sent: " + data); 
        }
    });
}

function createGumball (name, top, left) {

    var div_name = 'gm_' + name;
    if (!$("#" + div_name).length) {
	$('<div>').attr({ id: div_name, class:"gumball" }
		       ).css({ "position": "absolute", "top": top + "px", "left": left + "px"}
			    ).insertAfter('.gumball:last');

	$('<img>').attr({ id: "gmbody", src: "img/gm.png" }).css({"position":"absolute", "top":"0px", "left":"0px"}).appendTo("#" + div_name);
	$('<img>').attr({ id: "cold", src: "img/hat.png" }).css({"position":"absolute", "top":"0px", "left":"0px"}).appendTo("#" + div_name);
	$('<img>').attr({ id: "hot", src: "img/sweat.png" }).css({"position":"absolute", "top":"0px", "left":"0px"}).appendTo("#" + div_name);
	$('<img>').attr({ id: "noisy", src: "img/headphone.png" }).css({"position":"absolute", "top":"0px", "left":"0px"}).appendTo("#" + div_name);
	$('<img>').attr({ id: "privacy", src: "img/mask.png" }).css({"position":"absolute", "top":"0px", "left":"0px"}).appendTo("#" + div_name);
	$('<img>').attr({ id: "bright", src: "img/sunglasses.png" }).css({"position":"absolute", "top":"0px", "left":"0px"}).appendTo("#" + div_name);
	$('<p>'+ name +'</p>').css({"position":"absolute", "top":"86px", "left":"85px", "background-color":"white"}).appendTo("#" + div_name);

    }
}


function initGumball (name) {
    $("#gm_" + name + " #cold").hide();
    $("#gm_" + name + " #hot").hide();
    $("#gm_" + name + " #noisy").hide();
    $("#gm_" + name + " #privacy").hide()
    $("#gm_" + name + " #bright").hide();

    $("#gm_" + name + " #gmbody").css({"opacity": 0.4});
}
</script>

	  
</head>
<body>

<div class="TTWForm-container">

    <div id="status"> Connecting... please wait for seconds.</div>
    <div class="div_nickname"></div>

</div>

</body>

</html>














